{% extends 'base.html' %}
{% load humanize %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 text-primary"><i class="bi bi-receipt me-2"></i> Salary Slip Detail</h1>
            <div>
                <a href="{% url 'export_slip_pdf' pk=slip.pk %}" class="btn btn-danger"><i class="bi bi-file-earmark-pdf"></i> PDF/Print</a>
                <button onclick="window.history.back()" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back</button>
            </div>
        </div>

        <div class="card shadow-lg slip-container">
            <div class="card-header bg-light text-center py-4">
                <h4 class="mb-1 text-primary">EMPLOYEE PAYROLL SYSTEM</h4>
                <p class="mb-0 lead">SALARY SLIP - {{ slip.month_year|date:"F Y" }}</p>
            </div>
            <div class="card-body p-4">
                
                <div class="row mb-4 pb-2 border-bottom">
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Employee Name:</strong> {{ profile.user.get_full_name|default:profile.user.username }}</p>
                        <p class="mb-1"><strong>Employee ID:</strong> {{ profile.employee_id }}</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-1"><strong>Department:</strong> {{ profile.department }}</p>
                        <p class="mb-1"><strong>Job Title:</strong> {{ profile.job_title }}</p>
                    </div>
                </div>

                <h5 class="text-secondary border-bottom pb-1 mt-4">Attendance Summary</h5>
                <div class="row mb-4">
                    <div class="col-md-3">Days in Month: **{{ slip.total_working_days }}**</div>
                    <div class="col-md-3 text-success">Present Days: **{{ slip.present_days }}**</div>
                    <div class="col-md-3 text-warning">Leave Days: **{{ slip.leave_days }}**</div>
                    <div class="col-md-3 text-danger">Absent Days: **{{ slip.absent_days }}**</div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h5 class="text-secondary border-bottom pb-1 mt-4">Earnings (Monthly)</h5>
                        <table class="table table-sm">
                            <tr><td>Basic Salary</td><td class="text-end">${{ profile.basic_salary|floatformat:2|intcomma }}</td></tr>
                            <tr><td>HRA</td><td class="text-end">${{ profile.hra|floatformat:2|intcomma }}</td></tr>
                            <tr><td>Other Allowance</td><td class="text-end">${{ profile.other_allowance|floatformat:2|intcomma }}</td></tr>
                            <tr class="table-light"><td>**Gross Fixed Income**</td><td class="text-end fw-bold">${{ gross_earning_fixed|floatformat:2|intcomma }}</td></tr>
                            <tr class="table-success"><td>**TOTAL GROSS PAYABLE**</td><td class="text-end fw-bold">${{ slip.gross_salary|floatformat:2|intcomma }}</td></tr>
                        </table>
                    </div>
                    
                    <div class="col-md-6">
                        <h5 class="text-secondary border-bottom pb-1 mt-4">Deductions</h5>
                        <table class="table table-sm">
                            <tr><td>P.F. Deduction</td><td class="text-end">${{ profile.pf_deduction|floatformat:2|intcomma }}</td></tr>
                            <tr><td>Tax Deduction</td><td class="text-end">${{ profile.tax_deduction|floatformat:2|intcomma }}</td></tr>
                            <tr class="table-warning"><td>Absence Deduction ({{ slip.absent_days }} days)</td><td class="text-end text-danger">- ${{ absence_deduction|floatformat:2|intcomma }}</td></tr>
                            <tr class="table-danger"><td>**TOTAL DEDUCTIONS**</td><td class="text-end fw-bold text-danger">${{ slip.total_deductions|floatformat:2|intcomma }}</td></tr>
                            <tr><td></td><td></td></tr>
                            <tr><td></td><td></td></tr>
                        </table>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12 text-center bg-primary text-white py-3 rounded-3">
                        <h4 class="mb-0">NET SALARY PAYABLE: **${{ slip.net_salary|floatformat:2|intcomma }}**</h4>
                    </div>
                </div>

                <small class="d-block text-muted mt-3">Generated by: {{ slip.generated_by.username }} on {{ slip.generated_at|date:"Y-m-d H:i" }}</small>

            </div>
        </div>
    </div>
</div>
{% endblock %}